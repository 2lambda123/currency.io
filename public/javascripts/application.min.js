if(!this.JSON){if(!this.JSON)this.JSON={};(function(){function a(e){return e<10?"0"+e:e}function c(e){o.lastIndex=0;return o.test(e)?'"'+e.replace(o,function(k){var f=s[k];return typeof f==="string"?f:"\\u"+("0000"+k.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function b(e,k){var f,h,l,p,n=m,j,d=k[e];if(d&&typeof d==="object"&&typeof d.toJSON==="function")d=d.toJSON(e);if(typeof q==="function")d=q.call(k,e,d);switch(typeof d){case "string":return c(d);case "number":return isFinite(d)?String(d):
"null";case "boolean":case "null":return String(d);case "object":if(!d)return"null";m+=r;j=[];if(Object.prototype.toString.apply(d)==="[object Array]"){p=d.length;for(f=0;f<p;f+=1)j[f]=b(f,d)||"null";l=j.length===0?"[]":m?"[\n"+m+j.join(",\n"+m)+"\n"+n+"]":"["+j.join(",")+"]";m=n;return l}if(q&&typeof q==="object"){p=q.length;for(f=0;f<p;f+=1){h=q[f];if(typeof h==="string")if(l=b(h,d))j.push(c(h)+(m?": ":":")+l)}}else for(h in d)if(Object.hasOwnProperty.call(d,h))if(l=b(h,d))j.push(c(h)+(m?": ":":")+
l);l=j.length===0?"{}":m?"{\n"+m+j.join(",\n"+m)+"\n"+n+"}":"{"+j.join(",")+"}";m=n;return l}}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+a(this.getUTCMonth()+1)+"-"+a(this.getUTCDate())+"T"+a(this.getUTCHours())+":"+a(this.getUTCMinutes())+":"+a(this.getUTCSeconds())+"Z":null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()}}var g=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
o=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,m,r,s={"\u0008":"\\b","\t":"\\t","\n":"\\n","\u000c":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},q;if(typeof JSON.stringify!=="function")JSON.stringify=function(e,k,f){var h;r=m="";if(typeof f==="number")for(h=0;h<f;h+=1)r+=" ";else if(typeof f==="string")r=f;if((q=k)&&typeof k!=="function"&&(typeof k!=="object"||typeof k.length!=="number"))throw Error("JSON.stringify");return b("",
{"":e})};if(typeof JSON.parse!=="function")JSON.parse=function(e,k){function f(l,p){var n,j,d=l[p];if(d&&typeof d==="object")for(n in d)if(Object.hasOwnProperty.call(d,n)){j=f(d,n);if(j!==undefined)d[n]=j;else delete d[n]}return k.call(l,p,d)}var h;e=String(e);g.lastIndex=0;if(g.test(e))e=e.replace(g,function(l){return"\\u"+("0000"+l.charCodeAt(0).toString(16)).slice(-4)});if(/^[\],:{}\s]*$/.test(e.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,
"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){h=eval("("+e+")");return typeof k==="function"?f({"":h},""):h}throw new SyntaxError("JSON.parse");}})()};String.prototype.count=function(a){return this.split(a).length};
var currencies=JSON.stringify({USD:{name:"US Dollar",symbol:"$",rate_usd:1},EUR:{name:"Euro",symbol:"\u20ac",rate_usd:1},GBP:{name:"British Pound",symbol:"\u00a3",rate_usd:1},CAD:{name:"Canadian Dollar",symbol:"$",rate_usd:1},AUD:{name:"Australian Dollar",symbol:"$",rate_usd:1},JPY:{name:"Japanese Yen",symbol:"\u00a5",rate_usd:1},INR:{name:"Indian Rupee",symbol:"\u0930",rate_usd:1},NZD:{name:"New Zealand Dollar",symbol:"$",rate_usd:1},CHF:{name:"Swiss Franc",symbol:"chf",rate_usd:1},SGD:{name:"Singapore Dollar",
symbol:"$",rate_usd:1},HKD:{name:"Hong Kong Dollar",symbol:"$",rate_usd:1}});if(!localStorage.currencies||localStorage.currencies.count(":")!==currencies.count(":")){localStorage.currencies=currencies;localStorage.from_to='{ "from": "JPY", "to": "AUD" }'}window.currencies=JSON.parse(localStorage.currencies);window.from_to=JSON.parse(localStorage.from_to);Object.prototype.touch=function(a){var c,b;if(window.Touch){this.addEventListener("touchstart",function(g){g.preventDefault();if(!(!g.touches||g.touches.length>1)){c=this;this.className+=" touched";this.addEventListener("touchmove",b=function(){},false)}},false);window.addEventListener("touchend",function(){c.className=c.className.replace(/\stouched/,"")});this.addEventListener("touchend",function(g){g.preventDefault();this.removeEventListener("touchmove",b);a&&a.apply(this,[g])},false)}else this.addEventListener("click",
a)};
for(var $=function(a,c){c=c||document;var b=c.querySelectorAll(a);return b.length>1?b:b[0]},Converter={draw_currencies:function(){var a="",c=window.currencies,b;for(b in c)if(window.currencies.hasOwnProperty(b)){a+="<li>";a+='<a href="#" id="from-'+b+'">&nbsp;</a>';a+="<em>"+c[b].symbol+"</em> "+c[b].name+" <em>("+b+")</em>";a+='<a href="#" id="to-'+b+'">&nbsp;</a>';a+="</li>"}$("#rate-selection ul").innerHTML=a},highlight_currencies:function(a,c){window.from_to.from=a;window.from_to.to=c;localStorage.from_to=JSON.stringify(window.from_to);
for(var b=0,g=rates.length;b<g;b++)rates[b].className="";$("#from-"+a).className="selected";$("#to-"+c).className="selected"},update_currency_display:function(a,c){a=a||window.from_to.from;c=c||window.from_to.to;var b=window.currencies[a],g=window.currencies[c];this.highlight_currencies(a,c);Calculator.rate=b.rate_usd*(1/g.rate_usd);$("#input h2").innerHTML="<em>"+b.symbol+"</em> "+b.name;$("#output h2").innerHTML="<em>"+g.symbol+"</em> "+g.name;html=a+" <em>&rarr;</em> "+c;$("#rates span").innerHTML=
html;Calculator.add("")},update_currencies:function(){if(navigator.onLine){var a=[],c;for(c in window.currencies)window.currencies.hasOwnProperty(c)&&a.push(c);var b=new XMLHttpRequest;b.open("POST","/exchange?currencies="+a.toString(),true);b.send(null);b.onreadystatechange=function(){if(b.readyState===4)if(this.status==200){var g=JSON.parse(b.responseText),o;for(o in g)window.currencies[o].rate_usd=g[o];localStorage.currencies=JSON.stringify(window.currencies);Converter.update_currency_display()}else console.error("Request failed.")}}}},
Calculator={input:$("#input h1"),output:$("#output h1"),rate:0,add:function(a){this.update_values((this.input.innerText!=="0"?this.strip_commas(this.input.innerText):"")+a)},update_values:function(a){a=this.strip_commas(a);var c=(a*this.rate).toFixed(2);a||(a=0);if(!/\./.test(a)&&(a.length>5||c.length>6))c=c.slice(0,-3);if(!(a.length>10||c.length>10)){if(/^\.$/.test(a))c="0.00";this.input.innerHTML=this.add_commas(a);this.output.innerHTML=this.add_commas(c)}},clear:function(){this.update_values("0")},
add_commas:function(a){var c=/(\d+)(\d{3,3})/,b=(""+a).split(".");a=b[0];for(b=b[1]!==undefined?"."+b[1]:"";c.test(a);)a=a.replace(c,"$1,$2");return a+b},strip_commas:function(a){return a.replace(/,/g,"")}},buttons=$("#input-pad p"),i=0,ii=buttons.length;i<ii;i++)buttons[i].id.length||buttons[i].touch(function(){Calculator.add(this.innerText)});$("#clear").touch(function(){Calculator.clear()});$("#input").touch(function(){$("body").className="edit-rates"});
$("#output").touch(function(){$("body").className="edit-rates"});$("#flip").touch(function(){$("body").className="flip";var a={from:window.from_to.from,to:window.from_to.to};Converter.update_currency_display(a.to,a.from)});$("#save").touch(function(){$("body").className=""});Converter.draw_currencies();var rates=$("#rate-selection a");i=0;
for(ii=rates.length;i<ii;i++)rates[i].touch(function(a){a.preventDefault();a=this.id.split("-");args=a[0]=="from"?[a[1],null]:[null,a[1]];Converter.update_currency_display.apply(Converter,args)});var detectOrientation=function(){if(window.orientation)$("body").className="credits";else $("body").className=""};detectOrientation();window.addEventListener("orientationchange",detectOrientation);if(!navigator.onLine)$("#network-status").className="offline";Converter.update_currency_display();
setTimeout(function(){Converter.update_currencies()},100);
