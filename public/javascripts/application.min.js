if(!this.JSON){if(!this.JSON)this.JSON={};(function(){function a(e){return e<10?"0"+e:e}function b(e){o.lastIndex=0;return o.test(e)?'"'+e.replace(o,function(k){var f=s[k];return typeof f==="string"?f:"\\u"+("0000"+k.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function c(e,k){var f,h,l,p,n=m,j,d=k[e];if(d&&typeof d==="object"&&typeof d.toJSON==="function")d=d.toJSON(e);if(typeof q==="function")d=q.call(k,e,d);switch(typeof d){case "string":return b(d);case "number":return isFinite(d)?String(d):
"null";case "boolean":case "null":return String(d);case "object":if(!d)return"null";m+=r;j=[];if(Object.prototype.toString.apply(d)==="[object Array]"){p=d.length;for(f=0;f<p;f+=1)j[f]=c(f,d)||"null";l=j.length===0?"[]":m?"[\n"+m+j.join(",\n"+m)+"\n"+n+"]":"["+j.join(",")+"]";m=n;return l}if(q&&typeof q==="object"){p=q.length;for(f=0;f<p;f+=1){h=q[f];if(typeof h==="string")if(l=c(h,d))j.push(b(h)+(m?": ":":")+l)}}else for(h in d)if(Object.hasOwnProperty.call(d,h))if(l=c(h,d))j.push(b(h)+(m?": ":":")+
l);l=j.length===0?"{}":m?"{\n"+m+j.join(",\n"+m)+"\n"+n+"}":"{"+j.join(",")+"}";m=n;return l}}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+a(this.getUTCMonth()+1)+"-"+a(this.getUTCDate())+"T"+a(this.getUTCHours())+":"+a(this.getUTCMinutes())+":"+a(this.getUTCSeconds())+"Z":null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()}}var g=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
o=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,m,r,s={"\u0008":"\\b","\t":"\\t","\n":"\\n","\u000c":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},q;if(typeof JSON.stringify!=="function")JSON.stringify=function(e,k,f){var h;r=m="";if(typeof f==="number")for(h=0;h<f;h+=1)r+=" ";else if(typeof f==="string")r=f;if((q=k)&&typeof k!=="function"&&(typeof k!=="object"||typeof k.length!=="number"))throw Error("JSON.stringify");return c("",
{"":e})};if(typeof JSON.parse!=="function")JSON.parse=function(e,k){function f(l,p){var n,j,d=l[p];if(d&&typeof d==="object")for(n in d)if(Object.hasOwnProperty.call(d,n)){j=f(d,n);if(j!==undefined)d[n]=j;else delete d[n]}return k.call(l,p,d)}var h;e=String(e);g.lastIndex=0;if(g.test(e))e=e.replace(g,function(l){return"\\u"+("0000"+l.charCodeAt(0).toString(16)).slice(-4)});if(/^[\],:{}\s]*$/.test(e.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,
"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){h=eval("("+e+")");return typeof k==="function"?f({"":h},""):h}throw new SyntaxError("JSON.parse");}})()};String.prototype.count=function(a){return this.split(a).length};
var currencies=JSON.stringify({USD:{name:"US Dollar",symbol:"$",rate_usd:1},EUR:{name:"Euro",symbol:"\u20ac",rate_usd:1},GBP:{name:"British Pound",symbol:"\u00a3",rate_usd:1},CAD:{name:"Canadian Dollar",symbol:"$",rate_usd:1},AUD:{name:"Australian Dollar",symbol:"$",rate_usd:1},JPY:{name:"Japanese Yen",symbol:"\u00a5",rate_usd:1},INR:{name:"Indian Rupee",symbol:"\u0930",rate_usd:1},NZD:{name:"New Zealand Dollar",symbol:"$",rate_usd:1},CHF:{name:"Swiss Franc",symbol:"chf",rate_usd:1},SGD:{name:"Singapore Dollar",
symbol:"$",rate_usd:1},HKD:{name:"Hong Kong Dollar",symbol:"$",rate_usd:1}});if(!localStorage.currencies||localStorage.currencies.count(":")!==currencies.count(":")){localStorage.currencies=currencies;localStorage.from_to='{ "from": "JPY", "to": "AUD" }'}window.currencies=JSON.parse(localStorage.currencies);window.from_to=JSON.parse(localStorage.from_to);Object.prototype.touch=function(a){var b,c;if(window.Touch){this.addEventListener("touchstart",function(g){g.preventDefault();if(!(!g.touches||g.touches.length>1)){b=this;this.className+=" touched";this.addEventListener("touchmove",c=function(){},false)}},false);window.addEventListener("touchend",function(){if(b)b.className=b.className.replace(/\stouched/,"")});this.addEventListener("touchend",function(g){g.preventDefault();this.removeEventListener("touchmove",c);a&&a.apply(this,[g])},false)}else this.addEventListener("click",
a)};
for(var addClass=function(a,b){RegExp("(\\s|^)"+b+"(\\s|$)").test(a.className)||(a.className+=" "+b)},removeClass=function(a,b){a.className=a.className.replace(RegExp("(\\s|^)"+b+"(\\s|$)")," ")},$=function(a,b){b=b||document;var c=b.querySelectorAll(a);return c.length>1?c:c[0]},Converter={draw_currencies:function(){var a="",b=window.currencies,c;for(c in b)if(window.currencies.hasOwnProperty(c)){a+="<li>";a+='<a href="#" id="from-'+c+'">&nbsp;</a>';a+="<em>"+b[c].symbol+"</em> "+b[c].name+" <em>("+c+
")</em>";a+='<a href="#" id="to-'+c+'">&nbsp;</a>';a+="</li>"}$("#rate-selection ul").innerHTML=a},highlight_currencies:function(a,b){window.from_to.from=a;window.from_to.to=b;localStorage.from_to=JSON.stringify(window.from_to);for(var c=0,g=rates.length;c<g;c++)rates[c].className="";$("#from-"+a).className="selected";$("#to-"+b).className="selected"},update_currency_display:function(a,b){a=a||window.from_to.from;b=b||window.from_to.to;var c=window.currencies[a],g=window.currencies[b];this.highlight_currencies(a,
b);Calculator.rate=c.rate_usd*(1/g.rate_usd);$("#input h2").innerHTML="<em>"+c.symbol+"</em> "+c.name;$("#output h2").innerHTML="<em>"+g.symbol+"</em> "+g.name;html=a+" <em>&rarr;</em> "+b;$("#rates span").innerHTML=html;Calculator.add("")},update_currencies:function(){if(navigator.onLine){var a=[],b;for(b in window.currencies)window.currencies.hasOwnProperty(b)&&a.push(b);var c=new XMLHttpRequest;c.open("POST","/exchange?currencies="+a.toString(),true);c.send(null);c.onreadystatechange=function(){if(c.readyState===
4)if(this.status==200){var g=JSON.parse(c.responseText),o;for(o in g)if(g.hasOwnProperty(o)&&o!=="USD")window.currencies[o].rate_usd=g[o];localStorage.currencies=JSON.stringify(window.currencies);Converter.update_currency_display()}else console.error("Request failed.")}}}},Calculator={input:$("#input h1"),output:$("#output h1"),rate:0,add:function(a){this.update_values((this.input.innerText!=="0"?this.strip_commas(this.input.innerText):"")+a)},update_values:function(a){a=!a?0:this.strip_commas(a);
var b=isNaN(a)?"0.00":(a*this.rate).toFixed(2);if(!(a.length>9||b.length>9)){this.input.innerHTML=this.add_commas(a);this.output.innerHTML=this.add_commas(b)}},clear:function(){this.update_values("0")},add_commas:function(a){var b=/(\d+)(\d{3,3})/,c=(""+a).split(".");a=c[0];for(c=c[1]!==undefined?"."+c[1]:"";b.test(a);)a=a.replace(b,"$1,$2");return a+c},strip_commas:function(a){return a.replace(/,/g,"")}},buttons=$("#input-pad p"),i=0,ii=buttons.length;i<ii;i++)buttons[i].id.length||buttons[i].touch(function(){Calculator.add(this.innerText)});
$("#clear").touch(function(){Calculator.clear()});$("#input").touch(function(){addClass($("body"),"edit-rates")});$("#output").touch(function(){addClass($("body"),"edit-rates")});$("#flip").touch(function(){addClass($("body"),"flip");setTimeout(function(){var a={from:window.from_to.from,to:window.from_to.to};Converter.update_currency_display(a.to,a.from)},130);setTimeout(function(){removeClass($("body"),"flip")},275)});$("#save").touch(function(){removeClass($("body"),"edit-rates")});Converter.draw_currencies();
var rates=$("#rate-selection a");i=0;for(ii=rates.length;i<ii;i++)rates[i].touch(function(a){a.preventDefault();a=this.id.split("-");args=a[0]=="from"?[a[1],null]:[null,a[1]];Converter.update_currency_display.apply(Converter,args)});var detectOrientation=function(){window.orientation?addClass($("body"),"credits"):removeClass($("body"),"credits")};detectOrientation();window.addEventListener("orientationchange",detectOrientation);if(!navigator.onLine)$("#network-status").className="offline";Converter.update_currency_display();
setTimeout(function(){Converter.update_currencies()},100);
